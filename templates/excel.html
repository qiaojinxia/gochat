<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>动态创建表格</title>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
    <style>
        /* 全局样式 */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }

        /* 导航栏样式 */
        header {
            height: 60px;
            background-color: #333;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        #outer-container{
            border: 1px solid #dbdada;
            box-shadow: 6px 6px 6px #cdcbcb;
            padding: 10px;
            border-radius: 8px;
            width: 80%;
            margin:0 auto;
            padding-bottom: 14px;

        }
        .logo {
            font-size: 24px;
        }

        nav ul {
            list-style: none;
            display: flex;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        nav ul li {
            margin-right: 20px;
        }

        nav ul li:last-child {
            margin-right: 0;
        }

        nav ul li a {
            color: #fff;
            text-decoration: none;
        }

        nav ul li a:hover {
            color: #ff4500;
        }
        table{
            width: 100%;
            margin: 0 auto;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            border: 1px solid black;
        }
        th {
            background-color: #cdd5e5;
            font-weight: bold;
            text-align: center;
        }

        #outer-container{
            margin-top: 20px;
        }

        input[type="text"] {
            padding: 8px;
            border-radius: 4px;
            width: 60%;
            border: 1px solid #ccc; /*添加一个1像素的灰色边框*/
            box-shadow: 2px 2px 5px #888; /*添加一个2像素的阴影，阴影颜色为深灰色*/
            font-size: 20px;
        }

        input[type="text"]:focus {
            border-color: #38beae;
        }

        button {
            padding: 8px 16px 4px 16px;
            border-radius: 4px;
            border: none;
            background-color: #4caf50;
            color: white;
            cursor: pointer;
            height: 40px;
        }

        #form-container{
            position: fixed;
            bottom: 0;
            margin-bottom: 20px; /* 为其他元素留出足够的空间 */
            width: 100%;
        }

        #list-container{


            position: absolute;
            left: 7%;
        }

        #list-container ul{

            list-style: none;

        }
        .page-tag-div {
            position: relative;
            width:50px;
            height: 25px;
            border: none;
            padding: 2px;
            text-align: center;
            background-color: #F0F0F0;
            float: left;
            border-radius: 7px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5); /* 设置边缘阴影 */
            border: 3px solid #ccc; /*添加一个1像素的灰色边框*/
        }

    </style>
</head>
<body>


<header>
    <div class="logo">草帽Boy的Logo</div>
    <nav>
        <ul>
            <li><a id= "uploadBtn" href="#">上传</a></li>
            <li><a id= "downloadBtn" href="#">下载</a></li>
            <li><a href="#">关于我们</a></li>
        </ul>
    </nav>

</header>

<form>
    <div id="myForm" action="/uploadExcel" method="post" enctype="multipart/form-data">
        <input id="myFile" type="file" name="myFile" style="display:none;"/>
    </div>
</form>

<div id="outer-container">
    <div id="myTable"></div>
    <div id="list-container">
        <ul id="myList"> </ul>
    </div>
</div>
<div id="form-container" style="text-align:center;">
    <input type="text" id="post-input" placeholder="Type something...">
    <button onclick="postData()">Send</button>

</div>

</body>
<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<script  src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script  src="/static/js/table.js"></script>

<script>
    const tableList = new Map();
    // function to handle form submission
    function postData() {
        const postContent = document.getElementById("post-input").value;
        fetch('http://example.com/api/post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                content: postContent
            })
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('Post submitted successfully!');
                document.getElementById("post-input").value = ""; // clear input field
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Error submitting post. Please try again later.');
            });
    }

    document.querySelector("#uploadBtn").addEventListener("click", function(){
        // 弹出文件选择框
        document.querySelector("#myFile").click();
    });

    // 上传文件
    document.getElementById("myFile").onchange = function() {
        if(window.FormData) {
            let formData = new FormData();
            // 建立一个upload表单项，值为上传的文件
            formData.append('uploadFile', document.getElementById('myFile').files[0]);
            let xhr = new XMLHttpRequest();
            document.getElementById("myForm")
            let form = document.getElementById("myForm");
            let formUrl = form.getAttribute("action");
            xhr.open('POST', formUrl);
            // 定义上传完成后的回调函数
            xhr.onload = function () {
                if (xhr.status === 200) {
                    const respObj = JSON.parse(xhr.response);
                    console.log('上传成功 保存文件名:',respObj.filename);
                    addListItem(respObj.filename);
                    showExcelData('/downloadExcel/' + respObj.filename);
                } else {
                    console.log('出错了');
                }
            };
            xhr.send(formData);
        }
    };

    // JavaScript 代码中的下载按钮点击事件
    document.querySelector("#downloadBtn").addEventListener("click", function(){
        let xhr = new XMLHttpRequest();
        xhr.open("GET", "xxx地址", true);
        xhr.responseType = "blob";
        xhr.onload = function(){
            if (xhr.status === 200) {
                let fileBlob = xhr.response;
                let a = document.createElement("a");
                let url = window.URL.createObjectURL(fileBlob);
                a.href = url;
                a.download = "myFile.txt";
                a.click();
                window.URL.revokeObjectURL(url);
            }
        };
        xhr.send();
    });


    function addKeyValueToMap(map, valueToAdd){
        const key = '表格' + (Object.keys(map).length + 1);
        map[key] = valueToAdd;
        return map;
    }

    // 初始化页面，展示默认的Excel文件解析结果
    // showExcelData('localhost:8080/downloadExcel/' + '123');

    function addListItem(item) {
        addKeyValueToMap(tableList,item)
        refreshList();
    }

    function removeListItem(index) {
        tableList.splice(index, 1);
        refreshList();
    }

    function refreshList() {
        let list = document.getElementById("myList");
        list.innerHTML = "";
        for (let i = 0; i < myList.length; i++) {
            let pageTagDiv = document.createElement("div");
            pageTagDiv.className = "page-tag-div";
            let li = document.createElement("li");
            li.innerHTML = myList[i];
            li.className = "list-item";
            li.onclick = function() { removeListItem(i); };
            pageTagDiv.appendChild(li);
            list.appendChild(pageTagDiv);
        }
    }

    function highlightListItem(e) {
        e.target.classList.add("highlight");
    }

    function unhighlightListItem(e) {
        e.target.classList.remove("highlight");
    }

    let list = document.getElementById("list-container");

    list.addEventListener("mouseover", highlightListItem);
    list.addEventListener("mouseout", unhighlightListItem);
    refreshList();


</script>

</html>
